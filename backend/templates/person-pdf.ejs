<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title><%= person.name || "Profile" %> - Profile</title>
  <style>
    @page { size: A4; margin: 0; }
    html,body {
      margin:0; padding:0;
      font-family: "Helvetica", Arial, sans-serif;
      color: #111;
      -webkit-print-color-adjust: exact;
      print-color-adjust: exact;
    }
    .page { box-sizing: border-box; padding: 110px 40px 110px 40px; }

    /* HEADER */
    header {
      position: fixed;
      top: 0; left: 0; right: 0;
      height: 90px; padding: 12px 40px;
      border-bottom: 2px solid #444;
      display:flex; align-items:center; justify-content:space-between;
      background: #fff;
      z-index: 1000;
    }
    .header-left { display:flex; gap:16px; align-items:center; }
    .logo { 
      height:70px; width:auto; object-fit:contain;
      max-width: 200px;
    }
    .company-meta {
      font-size:14px; line-height:1.3; color:#000;
    }
    .company-meta strong {
      font-size:20px;
      font-weight:700;
      color: maroon;
    }
    .header-right {
      text-align:right;
      font-size:14px;
      font-weight:600;
    }

    footer {
      position: fixed;
      bottom: 0; left: 0; right: 0;
      height: 90px; padding: 12px 40px;
      border-top: 1px solid #ddd;
      font-size:11px; color:#444; background:#fff;
      z-index: 1000;
    }

    h1.title {
      font-size:22px;
      margin:0 0 12px 0;
      letter-spacing:0.5px;
      font-weight:700;
      color: maroon;
    }
    .profile-top { display:flex; gap:18px; margin-bottom:18px; }
    .profile-pic {
      width:180px; height:220px;
      object-fit:cover;
      border-radius:4px; border:1px solid #ccc;
      background: #f5f5f5;
    }
    .personal-details { flex:1; }
    .detail-row {
      display:flex; gap:12px; margin-bottom:6px;
      font-size:14px;
    }
    .label { width:180px; font-weight:600; color:#222; }
    .value { flex:1; }

    .section { margin-top:10px; page-break-inside: avoid; }
    .section h2 {
      font-size:15px;
      margin:8px 0;
      border-bottom:1px solid #eee;
      padding-bottom:6px;
      font-weight:700;
      color: maroon;
    }
    .family-table, .siblings-table {
      width:100%; border-collapse: collapse; margin-top:6px;
    }
    .family-table td, .siblings-table td {
      padding:6px 8px;
      border:1px solid #e8e8e8;
      vertical-align:top;
      font-size:13px;
    }
    .family-table td strong, .siblings-table td strong {
      color: maroon;
    }

    .disclaimer {
      font-size:11px; color:#666;
      margin-top:14px; line-height:1.25;
    }

    /* Photos Grid */
    .photo-grid {
      display:flex; 
      flex-wrap:wrap; 
      gap:10px;
      margin-top: 10px;
    }
    .photo-grid img {
      width:180px;
      height:auto;
      max-height: 220px;
      border:1px solid #ccc;
      border-radius:4px;
      object-fit:cover;
      background: #f5f5f5;
    }

    img {
      image-rendering: -webkit-optimize-contrast;
      image-rendering: optimize-contrast;
    }

    .section, .profile-top, .photo-grid {
      page-break-inside: avoid;
    }
  </style>
</head>
<body>
  <header>
    <div class="header-left">
      <% if (typeof logoUrl !== 'undefined' && logoUrl) { %>
        <img src="<%= logoUrl %>" class="logo" alt="Company Logo" onerror="this.style.display='none'" />
      <% } %>
      <div class="company-meta">
        <strong><%= companyName %></strong><br/>
        <span>üìû <%= PhoneNo %></span><br/>
        <span>üìß <%= companyEmail || "‚Äî" %></span><br/>
        <small>üìç <%= companyAddress %></small>
      </div>
    </div>
    <div class="header-right">
      Date: <%= new Date().toLocaleDateString() %>
    </div>
  </header>

  <div class="page">
    <h1 class="title">Profile Detail</h1>

    <div class="profile-top">
      <% if (person.profilePicture) { %>
        <%
          let profilePicUrl = '';
          if (person.profilePicture.startsWith('http')) {
            profilePicUrl = person.profilePicture;
          } else {
            profilePicUrl = baseUrl + '/uploads/' + person.profilePicture;
          }
        %>
        <img src="<%= profilePicUrl %>" class="profile-pic" alt="Profile Picture" 
             onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgwIiBoZWlnaHQ9IjIyMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZjVmNWY1Ii8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPk5vIEltYWdlPC90ZXh0Pjwvc3ZnPg=='" />
      <% } else { %>
        <div class="profile-pic" style="display:flex; align-items:center; justify-content:center; background:#f5f5f5; color:#999; font-size:14px;">
          No Profile Picture
        </div>
      <% } %>
      
      <div class="personal-details">
        <div class="detail-row"><div class="label">Name :</div><div class="value"><%= person.name || "‚Äî" %></div></div>
        <div class="detail-row"><div class="label">Gender :</div><div class="value"><%= person.gender || "‚Äî" %></div></div>
        <div class="detail-row"><div class="label">Marital Status :</div><div class="value"><%= person.maritalStatus || "‚Äî" %></div></div>
        <div class="detail-row"><div class="label">Date Of Birth :</div><div class="value"><%= person.dob || "‚Äî" %></div></div>
        <div class="detail-row"><div class="label">Native Place :</div><div class="value"><%= person.nativePlace || "‚Äî" %></div></div>
        <div class="detail-row"><div class="label">Height :</div><div class="value"><%= person.height || "‚Äî" %></div></div>
        <div class="detail-row"><div class="label">Complexion :</div><div class="value"><%= person.complexion || "‚Äî" %></div></div>
        <div class="detail-row"><div class="label">Eating Habits :</div><div class="value"><%= person.eatingHabits || "‚Äî" %></div></div>
        <div class="detail-row"><div class="label">NRI :</div><div class="value"><%= person.nri ? "Yes" : "No" %></div></div>
      </div>
    </div>

    <!-- Uploaded Photos -->
    <% if (person.photos && Array.isArray(person.photos) && person.photos.length > 0) { %>
      <div class="section">
        <h2>Uploaded Photos</h2>
        <div class="photo-grid">
          <% person.photos.forEach((photo, idx) => { %>
            <div>
              <%
                let photoUrl = '';
                if (photo) {
                  if (photo.startsWith('http')) {
                    photoUrl = photo;
                  } else {
                    photoUrl = baseUrl + '/uploads/' + photo;
                  }
                }
              %>
              <img src="<%= photoUrl %>" alt="Photo <%= idx+1 %>" 
                   onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgwIiBoZWlnaHQ9IjE4MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZjVmNWY1Ii8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxMiIgZmlsbD0iIzk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPkltYWdlIE5vdCBGb3VuZDwvdGV4dD48L3N2Zz4='" />
            </div>
          <% }) %>
        </div>
      </div>
    <% } %>

    <div class="section">
      <h2>Educational & Profession</h2>
      <div class="detail-row"><div class="label">Higher Qualification :</div><div class="value"><%= person.higherQualification || person.education || "‚Äî" %></div></div>
      <div class="detail-row"><div class="label">Occupation :</div><div class="value"><%= person.occupation || "‚Äî" %></div></div>
      <div class="detail-row"><div class="label">Personal Income :</div><div class="value"><%= person.personalIncome || person.income || "‚Äî" %></div></div>
      <div class="detail-row"><div class="label">Residence :</div><div class="value"><%= person.residence || "‚Äî" %></div></div>
    </div>

    <div class="section">
      <h2>Family Details</h2>
      <table class="family-table">
        <tr>
          <td><strong>Father</strong></td><td><%= (person.family && person.family.father) || person.fatherName || "‚Äî" %></td>
          <td><strong>Mother</strong></td><td><%= (person.family && person.family.mother) || person.motherName || "‚Äî" %></td>
        </tr>
        <tr>
          <td><strong>Family Income</strong></td><td><%= person.familyIncome || "‚Äî" %></td>
          <td><strong>Other Property</strong></td><td><%= person.otherProperty || "‚Äî" %></td>
        </tr>
      </table>
    </div>

    <div class="section">
      <h2>Siblings & Extended Family</h2>
      <table class="siblings-table">
        <thead>
          <tr><td><strong>Name</strong></td><td><strong>Relation</strong></td><td><strong>Age</strong></td><td><strong>Profession</strong></td><td><strong>Marital Status</strong></td></tr>
        </thead>
        <tbody>
          <% if (Array.isArray(person.siblings) && person.siblings.length) { %>
            <% person.siblings.forEach(function(sib){ %>
              <tr>
                <td><%= sib.name || "‚Äî" %></td>
                <td><%= sib.relation || "‚Äî" %></td>
                <td><%= sib.age || "‚Äî" %></td>
                <td><%= sib.profession || "‚Äî" %></td>
                <td><%= sib.maritalStatus || "‚Äî" %></td>
              </tr>
            <% }) %>
          <% } else { %>
            <tr><td colspan="5">No sibling details available</td></tr>
          <% } %>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Last Page NOTE -->
  <div style="page-break-before: always; padding: 80px 40px; text-align: center;">
    <div style="font-size: 20px; font-weight: bold; margin-top: 32px; line-height: 1.6; background-color: maroon; color: white; padding: 20px; border-radius: 6px;">
      NOTE : The above particulars have been provided to the best of our knowledge, as per
      information provided by the concerned party.<br/>
      We ( Jodi No 1) shall not be responsible for misrepresentation of any or all of
      the information herein. Amount will not be refunded in any case.<br/>
      All clients have to pay full maturity amount on ROKA CEREMONY.
    </div>
  </div>

  <footer>
    <div style="display:flex;justify-content:space-between;align-items:center;">
      <div>
        <strong><%= companyName %></strong><br/>
        <small><%= PhoneNo %> | <%= companyAddress %></small>
      </div>
      <div style="text-align:right;">
        <small>By Mamta Aggarwal, 9871080409, 9211729184, 9211729185, 9211729186</small><br/>
        <small>www.jodino1@gmail.com</small>
      </div>
    </div>
  </footer>
</body>
</html>